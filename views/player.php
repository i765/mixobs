<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MIXOBS - Мix Observatory</title>
	<link rel="stylesheet" href="http://localhost/res/style.css?v=<? echo time(); ?>">
</head>
<body>

	<div class="alert-overlay hidden">
		<div class="message"></div>
	</div>
	<div class="toppanel-container">
		<div class="toppanel">
			<div class="logotype"></div>
			<div id="analyserContainer"></div>
			<div class="topnav">
				<a href="#">Подкасты</a>
				<a href="#">Лайвы</a>
				<a href="#">Видео</a>
				<a href="#">Расписание</a>
				<a href="#">Войти</a>
			</div>
			<div id="equalizerContainer"><div class="equalizer-container"></div></div>
		</div>
	</div>

	<div class="container">

		<div class="document">
			<div class="cover">
				<div class="cover-bg">
					<div class="cover-bg-blur"></div>
				</div>
				<div class="cover-image"></div>
			</div>
			
			<h1>Cosmic Gate - Wake Your Mind Episode 523</h1>
			<div class="player">
				<div class="player-loader"></div>
				<div class="play-button"></div>
				<div class="seek-bar">
					<div class="seek-position"></div>
					<div class="seek-zone"></div>
				</div>
				<div class="vol-bar">
					<div class="vol-position"></div>
					<div class="vol-zone"></div>
				</div>
				<div class="time-current">00:00:00</div>
				<div class="time-total">00:00:00</div>	
			</div>


<div class="table">
	<div class="table-colgroup">
		<div class="table-col" style="width: 9%"></div>
		<div class="table-col" style="width: 91%"></div>
	</div>
	<div class="table-tbody"> 
		<div class="table-tr" data-timecode="31">
			<div class="table-td">00:00:31</div>
			<div class="table-td">Genix - On & On (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="300">
			<div class="table-td">00:05:00</div>
			<div class="table-td">My Friend - Moonbeam (Anjunadeep)</div>	
		</div>
		<div class="table-tr" data-timecode="595">
			<div class="table-td">00:09:55</div>
			<div class="table-td">Ferry Corsten feat. Chris Howard - Where The Mountains Grow (Flashover)</div>	
		</div>
		<div class="table-tr" data-timecode="913">
			<div class="table-td">00:15:13</div>
			<div class="table-td">RECORD OF THE WEEK: Kasablanca & Lane 8 - Remission (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="1257">
			<div class="table-td">00:20:57</div>
			<div class="table-td">Estiva - Fine Day (Colorize)</div>	
		</div>
		<div class="table-tr" data-timecode="1551">
			<div class="table-td">00:25:51</div>
			<div class="table-td">Made For You - Love Vibration (Steve Brian)</div>	
		</div>
		<div class="table-tr" data-timecode="1764">
			<div class="table-td">00:29:24</div>
			<div class="table-td">Rodrigo Deem & Leonard A - Dos Almas (Enhanced Progressive)</div>	
		</div>
		<div class="table-tr" data-timecode="2047">
			<div class="table-td">00:34:07</div>
			<div class="table-td">Protoculture, DIM3NSION & Dennis Sheperd - Sublimity (Black Hole)</div>	
		</div>
		<div class="table-tr" data-timecode="2267">
			<div class="table-td">00:37:47</div>
			<div class="table-td">Duderstadt - Muhanjala [Dylhen Remix] (Armada)</div>	
		</div>
		<div class="table-tr" data-timecode="2557">
			<div class="table-td">00:42:37</div>
			<div class="table-td">YOTTO & AVIRA feat. Also Astir - Forget (Armada)</div>	
		</div>
		<div class="table-tr" data-timecode="2826">
			<div class="table-td">00:47:06</div>
			<div class="table-td">Le Youth & Forester & Lyrah - Stay Still (This Never Happened)</div>	
		</div>
		<div class="table-tr" data-timecode="3135">
			<div class="table-td">00:52:15</div>
			<div class="table-td">ayokay - Feel It (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="3356">
			<div class="table-td">00:55:56</div>
			<div class="table-td">Robby East & Jodie Knight - Overwater (This Never Happened)</div>	
		</div>
		<div class="table-tr" data-timecode="3588">
			<div class="table-td">00:59:48</div>
			<div class="table-td">PUSH THE BUTTON: Gabriel & Dresden - Kinetic Cinema (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="3916">
			<div class="table-td">01:05:16</div>
			<div class="table-td">My Friend & Tailor - The Calm (Anjunadeep)</div>	
		</div>
		<div class="table-tr" data-timecode="4237">
			<div class="table-td">01:10:37</div>
			<div class="table-td">Cosmic Gate & Christian Burns - Brave (Wake Your Mind)</div>	
		</div>
		<div class="table-tr" data-timecode="4572">
			<div class="table-td">01:16:12</div>
			<div class="table-td">Romain Garcia - Last Night (Anjunadeep)</div>	
		</div>
		<div class="table-tr" data-timecode="4897">
			<div class="table-td">01:21:37</div>
			<div class="table-td">Grum - Voyager2 (Being)</div>	
		</div>
		<div class="table-tr" data-timecode="5150">
			<div class="table-td">01:25:50</div>
			<div class="table-td">FLASHBACK: Oliver Smith - Evermore (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="5393">
			<div class="table-td">01:29:53</div>
			<div class="table-td">GUEST MIX: DOKHO: Rezident feat. Kate Morgan - Let Me Be Your Muse (Anjunadeep)</div>	
		</div>
		<div class="table-tr" data-timecode="5654">
			<div class="table-td">01:34:14</div>
			<div class="table-td">GUEST MIX: DOKHO: rshand - Erased (Monstercat Silk)</div>	
		</div>
		<div class="table-tr" data-timecode="5841">
			<div class="table-td">01:37:21</div>
			<div class="table-td">GUEST MIX: DOKHO: Dokho - Luna's Dream (Colorize)</div>	
		</div>
		<div class="table-tr" data-timecode="6109">
			<div class="table-td">01:41:49</div>
			<div class="table-td">GUEST MIX: DOKHO: Dokho - ID (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="6368">
			<div class="table-td">01:46:08</div>
			<div class="table-td">GUEST MIX: DOKHO: Dokho - ID (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="6653">
			<div class="table-td">01:50:53</div>
			<div class="table-td">GUEST MIX: DOKHO: Above & Beyond pres. OceanLab - Sirens Of The Sea [Marsh Remix] (Anjunabeats)</div>	
		</div>
		<div class="table-tr" data-timecode="6897">
			<div class="table-td">01:54:57</div>
			<div class="table-td">GUEST MIX: DOKHO: Fast Distance - Bosphore (A State Of Trance)</div>	
		</div>

	</div> 
</div>





<div class="document-footer">
	<div class="release-info">
		<div class="release-date">
			<div class="release-icon"></div>
			12.04.2024
		</div>
		
	</div>
	<div class="release-buttons">
		<div class="like-counter">243</div>
		<div class="image-button thumb-up-button" title="Нравится"></div>
		<div class="dislike-counter">13</div>
		<div class="image-button thumb-down-button" title="Не нравится"></div>
		<div class="image-button download-button" title="Скачать файл"></div>
		<div class="image-button share-button" title="Поделиться"></div>
	</div>
</div>


</div>

</div>


<div class="footer">
	
</div>


<script>

	const player = new Audio();
	const context = new AudioContext();
	let source = context.createMediaElementSource(player);
	let analyser = context.createAnalyser();
	let gainNode = context.createGain();
	const frequencies = [60, 125, 310, 600, 1000, 3000, 6000, 8000, 14000, 16000];

	if (localStorage.getItem('volume') == null) {
			localStorage.setItem('volume', 1);
		}

	function freqToText(freq){
		if (freq < 1000) {
			return freq.toString();
		} else {
			return freq.toString().slice(0, -3) + 'K';
		}
	}
	
	function eqFilter(freq){
		let filter = context.createBiquadFilter();
		filter.type = 'peaking'; // тип фильтра
		filter.frequency.value = freq; // частота
		filter.Q.value = 1; // Q-factor

		const eqRefreshInterval = setInterval(function(){
			if (localStorage.getItem(freq) == null) {
			localStorage.setItem(freq, 0);
			} else {
				filter.gain.value = localStorage.getItem(freq);
			}
		}, 1000);

		return filter;
	}

	function createEQ() {
		
		eq = frequencies.map(eqFilter);
		eq.reduce(function (prev, curr) {
			prev.connect(curr);
			return curr;
		});

		return eq;
	};

	let equalizer = createEQ();
	
	source.connect(equalizer[0]);
	equalizer[equalizer.length - 1].connect(analyser);	


	analyser.connect(gainNode);
	
	gainNode.connect(context.destination);

	analyser.fftSize = 2048;
	analyser.smoothingTimeConstant = 0.5;
	analyser.maxDecibels = -21;
	analyser.minDecibels = -74;
	const numBars = 14;
	const frequencyArray = new Uint8Array(analyser.frequencyBinCount);
	const frequencyMatrix = new Uint8Array(numBars+1);
	const frequencySet = [
			[2,3,0.75],
			[4,5,0.78],
			[6,9,0.82],
			[10,12,0.85],
			[13,14,0.93],
			[15,16,0.95],
			[17,19,0.98],
			[20,50,1],
			[51,80,0.9],
			[61,111,0.91],
			[112,212,0.92],
			[213,313,0.95],
			[314,414,1],
			[415,515,1.2],
			[516,2048,1.32]
		];

	player.id = 'player';
	player.preload = 'metadata';
	player.type = 'audio/mpeg';
	player.crossOrigin = "*";
	// player.src = 'http://data.localhost/audio/16Hz-20kHz-Exp-1f-10sec.mp3';
	player.src = 'http://data.localhost/audio/?v=4';
	
	
	const eqCont = QS('.equalizer-container');

	// Отрисовка блоков эквалайзера
	for (let x = 0; x < frequencies.length; x++) {
		let freq = frequencies[x];
		let divEB = document.createElement("div");
		let divEQP = document.createElement("div");
		let divEBZ = document.createElement("div");
		let divEBBT = document.createElement("div");
		divEB.classList.add('eq-bar');
		divEQP.classList.add('eq-position');
		divEBZ.classList.add('eq-bar-zone');
		divEBBT.classList.add('eq-bottom-text');
		divEBZ.dataset.frq = freq;
		divEB.append(divEBBT);
		divEB.append(divEQP);
		divEB.append(divEBZ);
		eqCont.append(divEB);
		divEBBT.innerHTML = freqToText(freq);
	
	}
	

	// Восстановление значений эквалайзера
	const eqBarsZn = QSA('.eq-bar-zone');
	const eqBars = QSA('.eq-bar');
	const eqPos = QSA('.eq-position');
	const eqValueText = QSA('.eq-bottom-text');

	for (let x = 0; x < frequencies.length; x++) {
		let val = localStorage.getItem(eqBarsZn[x].dataset.frq);
		eqPos[x].style.top = 50 - (val * 5) + 'px';
	}	

	
	// Обработка событий эквалайзера
	for (let x = 0; x < frequencies.length; x++) {
		eqBars[x].style.left = x * 35 + 'px';
		MEL(eqBarsZn[x], 'mousemove mouseup mousedown click', function(e){
			if(event.buttons === 1) {
				
				let frq = e.target.dataset.frq;
				let val = Math.round((50 - e.offsetY) / 5);
				e.target.closest('.eq-bar').children[1].style.top = 50 - (val * 5) + 'px';
				localStorage.setItem(frq, val);
								
				eqValueText[x].innerHTML = val;

			}	
		});

		MEL(eqBarsZn[x], 'mouseenter mousemove mousedown', function(e){
			e.target.closest('.eq-bar').children[1].classList.add('eq-position-hovered');
		});

		eqBarsZn[x].onmouseleave = function(){
			setTimeout(()=>{
				eqValueText[x].innerHTML = freqToText(frequencies[x]);
				eqPos[x].classList.remove('eq-position-hovered');
			}, 500);
		
			
		
		}
	}
	
	/* Анализатор спектра */

	const analyserContainer = O('analyserContainer');
	const equalizerContainer = O('equalizerContainer');

	analyserContainer.onclick = function(){
		equalizerContainer.style.display = 'block';
	}

	for (var i = 0; i <= numBars; i++) {
		let bar = document.createElement('div');
		let dot = document.createElement('div');
		bar.className = 'bar';
		dot.className = 'dot';
		analyserContainer.appendChild(bar);
		analyserContainer.appendChild(dot);
	}

	const bars = QSA('.bar');
	const dots = QSA('.dot');


	const analyserTimer = setInterval(function(){
		
		analyser.getByteFrequencyData(frequencyArray);

		for (var i = 0; i <= numBars; i++) {
			frequencyMatrix[i] = Math.max.apply(null, frequencyArray.slice(frequencySet[i][0], frequencySet[i][1]));
		}

		let level = 0;
		
		for (var i = 0; i <= numBars; i++) {

			level = frequencyMatrix[i] / 12 * frequencySet[i][2];

			// bars[i].style.height = '0px';
			bars[i].style.height = level + 'px';
			bars[i].style.left = i * 8 + 'px';

			dots[i].style.bottom = level + 'px';
			dots[i].style.left = i * 8 + 'px';

		}

	}, 10);

	/* Интерфейс плеера */

	const playerLoader = QS('.player-loader');
	const seekBar = QS('.seek-bar');
	const seekPosition = QS('.seek-position');
	const volBar = QS('.vol-bar');
	const volPosition = QS('.vol-position');
	const playPause = QS('.play-button');
	const timeTotal = QS('.time-total');
	const timeCurrent = QS('.time-current');
	
	player.oncanplay = function(e){
		gainNode.gain.value = localStorage.getItem("volume");
		volPosition.style.width = gainNode.gain.value * 107 + 'px';
		updateTimeCodes();
	}

	player.onended = function(e){
		playPause.classList.remove('pause-button');
	}
	
	window.addEventListener("keydown", (e) => {
			
		if (e.keyCode == 37 || e.keyCode == 74) {
			player.currentTime = player.currentTime - 25;
		}

		if (e.keyCode == 75 || e.keyCode == 32) {
			
			if(player.paused){
				player.play();
				playPause.classList.add('pause-button');
			} else {
				player.pause();
				playPause.classList.remove('pause-button');
			}

			e.preventDefault();
			return false;

		}

		if (e.keyCode == 39 || e.keyCode == 76) {
			player.currentTime = player.currentTime + 25;
		}

	});

	// Работа с таймкодами
	function updateTimeCodes(){

		let Playlist = QSA('.table-tr');
		let currentTime = player.currentTime;
		let endTimecode = 0;
		let startTimecode = 0;

		for (var i = 0; i < Playlist.length; i++) {
		
			if (i < Playlist.length) {
				startTimecode = Playlist[i].dataset.timecode;
			}
			
			if (i < Playlist.length) {

				if (i == Playlist.length-1) {
					endTimecode = Math.round(player.duration);
				} else {
					endTimecode = Playlist[i+1].dataset.timecode;
				}
			}		

			if (currentTime > startTimecode && currentTime < endTimecode) {
				Playlist[i].children[0].classList.add('playing');
				Playlist[i].children[1].classList.add('playing');
			} else {
				Playlist[i].children[0].classList.remove('playing');
				Playlist[i].children[1].classList.remove('playing');
			}
		}


		
		if (player.paused) {
			player.currentTime = localStorage.getItem('time');
		}

		localStorage.setItem('time', player.currentTime);
	}

	// Таймер обновления таймкодов
	let playingTimer = setInterval(function(){

		if (player.duration > 1){
			playerLoader.style.display = 'none';
		}

		updateTimeCodes();

		let totalSec = Math.round(player.duration);
		let currentSec = Math.round(player.currentTime);
		timeTotal.innerHTML = secToStr(totalSec - currentSec);
		timeCurrent.innerHTML = secToStr(currentSec);
		seekPosition.style.width = player.currentTime * seekBar.offsetWidth / player.duration + 'px';
		
	}, 500);


	/* Плейлист */

	let trs = QSA('.table-tr');

	for (var i = trs.length - 1; i >= 0; i--) {
		trs[i].onclick = function(){
			player.currentTime = this.dataset.timecode;
			player.play();
			playPause.classList.add('pause-button');
		}
	}

	playPause.onclick = function(){
			
		if(player.paused){
			player.play();
			playPause.classList.add('pause-button');
		} else {
			player.pause();
			playPause.classList.remove('pause-button');
		}
		

	}

	seekBar.onclick = function(e){
		changeSeekRaw(e);
	}

	function changeSeekRaw(e){
		player.currentTime = e.offsetX / seekBar.offsetWidth * player.duration;
		seekPosition.style.width = e.offsetX + 'px';
		localStorage.setItem('time', player.currentTime);
	}

	volBar.onmousemove = function(e) {
	    if(event.buttons === 1) {
	    	changeVolumeRaw(e);
	    }		
	}
	volBar.onclick = function(e) {
	    changeVolumeRaw(e);
	}
	volBar.onmousedown = function(e) {
	    changeVolumeRaw(e);
	}

	volBar.onwheel = function(e){
		let max = 107;
		let cv = volPosition.clientWidth;
		
		if (e.deltaY > 0) {
			cv = cv - 5; 
		}

		if (e.deltaY < 0) {
			cv = cv + 5;
		}

		if (cv < 0) {
			cv = 0;
		}

		if (cv > 107) {
			cv = 107;
		}

		volPosition.style.width = cv + 'px';

		gainNode.gain.value = cv / max * 1;

		localStorage.setItem("volume", gainNode.gain.value);

		return false;
	}

	function changeVolumeRaw(e){
		let volume = e.offsetX / volBar.offsetWidth * 1;
		if(e.offsetX <= volBar.offsetWidth && e.offsetX > 0) {
			volPosition.style.width = e.offsetX + 'px';
			if(volume < 0.01) {
				volume = 0;
			}
			if(volume > 0.99) {
				volume = 1;
			}
			gainNode.gain.value = volume;
		}

		localStorage.setItem("volume", gainNode.gain.value);
	}

	function secToStr(s) {
		if (!s) {
			s = 0;
		}
		let m = Math.trunc(s / 60) + '';
		let h = Math.trunc(m / 60) + '';
		s = (s % 60) + '';
		m = (m % 60) + '';
		return h.padStart(2, 0) + ':' +m.padStart(2, 0) + ':' + s.padStart(2, 0);
	}
	
	function O(i){ 
		return document.getElementById(i);
	}
	function QS(i){ 
		return document.querySelector(i);
	}
	function QSA(i){ 
		return document.querySelectorAll(i);
	}
	function MEL(element, eventNames, listener) {
		let events = eventNames.split(' ');
		for (var i=0, iLen=events.length; i<iLen; i++) {
			element.addEventListener(events[i], listener, false);
		}
		return element;
	}

	
	async function request(url, data = []) {

		const response = await fetch(url, {
			method: 'POST',
			mode: 'same-origin',
			cache: 'no-cache',
			credentials: 'same-origin',
			headers: {'Content-Type': 'application/json; charset=utf-8'},
			redirect: 'error',
			referrerPolicy: 'no-referrer',
			body: JSON.stringify(data)
		});

		return await response.json();

	}


</script>

</body>
</html>